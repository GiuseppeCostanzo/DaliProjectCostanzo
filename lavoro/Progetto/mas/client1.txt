:- dynamic ticket_erogato/1.
:- dynamic progressivo/1.
:- dynamic chiamato/1.

/*
Tipolgie di operazione: 
1 -> Prelievo
2 -> Pagamento
3 -> Deposito
*/


/* Fatti */
stato(sveglio).
ticket_erogato(falso).
nome_agente(cliente1).
progressivo(0).
chiamato(falso).

quantoDepositoE :> write('Dovrei depositare 400 euro '),nl,messageA(sport1,send_message(depositare(Me,400),Me)).
quantoPrelievoE :> write('Dovrei prelevare 400 euro '),nl,messageA(sport1,send_message(prelevare(Me,300),Me)).
quantoPagamentoE :> write('Dovrei pagare 175 euro '),nl,messageA(sport1,send_message(pagare(Me,175),Me)).


/* Richiesta operazione allo sportellista - il cliente deve essere chiamato dallo sportellista */

sportellista_chiamandoE :> retract(chiamato(falso)),assert(chiamato(vero)).
scelta_operazione(Operazione) :- ticket_erogato(vero),chiamato(vero).

scelta_operazioneI(Operazione) :>
    random(1, 4, Operazione), 
    (Operazione == 1 -> OperazioneScelta = prelievo(Me,cliente1),write('Salve, sono cliente1, dovrei effettuare una operazione di prelievo!'),nl ; 
     Operazione == 2 -> OperazioneScelta = pagamento(Me,cliente1),write('Salve, sono cliente1, dovrei effettuare una operazione di pagamento!'),nl ; 
     Operazione == 3 -> OperazioneScelta = deposito(Me,cliente1),write('Salve, sono cliente1, dovrei effettuare una operazione di deposito!'),nl),
	 messageA(sport1,send_message(OperazioneScelta,Me)),nl.
	
fineOperazioneE :> write('Grazie, a presto'),retract(chiamato(vero)),assert(chiamato(falso)),retract(ticket_erogato(vero)),assert(ticket_erogato(falso)),nl.
	
/* Richiesta ticket al bigliettaio */
richiesta_ticket :- stato(sveglio).
richiesta_ticketI :> write('Salve, mi servirebbe il ticket per effettuare una operazione bancaria'),nl,messageA(ticket,send_message(richiede_ticket(Me,cliente1),Me)).
eroga_ticketE(N) :> write('Grazie mille'),nl,retract(ticket_erogato(falso)),assert(ticket_erogato(vero)),retract(progressivo(OldVal)), NewVal is OldVal + N, assert(progressivo(NewVal)),
					write('Ho il progressivo n. '),write(N),nl.
